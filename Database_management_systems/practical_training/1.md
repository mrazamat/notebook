# Конспект: Использование оператора SELECT

**Предмет:** Система управления базами данных  
**Специальность:** Вычислительная лингвистика

---

## 1. Введение в оператор SELECT

**SELECT** — основной оператор языка SQL для извлечения данных из базы данных. Это самый часто используемый оператор в работе с СУБД.

**Общий синтаксис:**
```sql
SELECT список_столбцов
FROM имя_таблицы
[WHERE условие]
[GROUP BY столбцы]
[HAVING условие]
[ORDER BY столбцы]
[LIMIT количество];
```

---

## 2. Базовые запросы SELECT

### 2.1. Выборка всех столбцов
```sql
SELECT * FROM students;
```
Знак `*` означает "все столбцы".

### 2.2. Выборка конкретных столбцов
```sql
SELECT name, age, email FROM students;
```

### 2.3. Выборка с псевдонимами (алиасами)
```sql
SELECT name AS student_name, age AS student_age 
FROM students;
```

---

## 3. Фильтрация данных (WHERE)

Оператор `WHERE` позволяет задавать условия для отбора строк.

### 3.1. Операторы сравнения
```sql
-- Равенство
SELECT * FROM students WHERE age = 20;

-- Больше/меньше
SELECT * FROM students WHERE age > 18;

-- Не равно
SELECT * FROM students WHERE city != 'Moscow';
```

### 3.2. Логические операторы
```sql
-- AND (И)
SELECT * FROM students 
WHERE age >= 18 AND city = 'Moscow';

-- OR (ИЛИ)
SELECT * FROM students 
WHERE city = 'Moscow' OR city = 'SPB';

-- NOT (НЕ)
SELECT * FROM students 
WHERE NOT city = 'Moscow';
```

### 3.3. Специальные операторы

#### IN — проверка на вхождение в список
```sql
SELECT * FROM students 
WHERE city IN ('Moscow', 'SPB', 'Kazan');
```

#### BETWEEN — диапазон значений
```sql
SELECT * FROM students 
WHERE age BETWEEN 18 AND 25;
```

#### LIKE — поиск по шаблону
```sql
-- Имена, начинающиеся на 'A'
SELECT * FROM students WHERE name LIKE 'A%';

-- Имена, содержащие 'anna'
SELECT * FROM students WHERE name LIKE '%anna%';

-- _ заменяет один символ
SELECT * FROM students WHERE name LIKE 'An_a';
```

**Символы подстановки:**
- `%` — любое количество любых символов (0 или более)
- `_` — ровно один любой символ

#### IS NULL / IS NOT NULL — проверка на NULL
```sql
SELECT * FROM students WHERE email IS NULL;
SELECT * FROM students WHERE email IS NOT NULL;
```

---

## 4. Сортировка результатов (ORDER BY)

```sql
-- По возрастанию (по умолчанию)
SELECT * FROM students ORDER BY age;
SELECT * FROM students ORDER BY age ASC;

-- По убыванию
SELECT * FROM students ORDER BY age DESC;

-- Сортировка по нескольким столбцам
SELECT * FROM students 
ORDER BY city ASC, age DESC;
```

---

## 5. Ограничение количества результатов (LIMIT)

```sql
-- Первые 10 записей
SELECT * FROM students LIMIT 10;

-- Пропустить 5 записей, затем взять 10
SELECT * FROM students LIMIT 10 OFFSET 5;

-- Альтернативный синтаксис (MySQL)
SELECT * FROM students LIMIT 5, 10;
```

**Применение:** пагинация результатов, выборка топ-N записей.

---

## 6. Агрегатные функции

Агрегатные функции выполняют вычисления над группой строк и возвращают одно значение.

### 6.1. Основные агрегатные функции

```sql
-- COUNT — подсчет количества строк
SELECT COUNT(*) FROM students;
SELECT COUNT(email) FROM students; -- не учитывает NULL

-- SUM — сумма значений
SELECT SUM(score) FROM exam_results;

-- AVG — среднее значение
SELECT AVG(age) FROM students;

-- MIN, MAX — минимум и максимум
SELECT MIN(age), MAX(age) FROM students;
```

### 6.2. COUNT с DISTINCT
```sql
-- Количество уникальных городов
SELECT COUNT(DISTINCT city) FROM students;
```

---

## 7. Группировка данных (GROUP BY)

`GROUP BY` группирует строки с одинаковыми значениями в указанных столбцах.

```sql
-- Количество студентов по городам
SELECT city, COUNT(*) AS student_count
FROM students
GROUP BY city;

-- Средний возраст по городам
SELECT city, AVG(age) AS avg_age
FROM students
GROUP BY city;

-- Группировка по нескольким столбцам
SELECT city, faculty, COUNT(*) AS count
FROM students
GROUP BY city, faculty;
```

**Важное правило:** В `SELECT` могут быть только столбцы из `GROUP BY` или агрегатные функции.

---

## 8. Фильтрация групп (HAVING)

`HAVING` используется для фильтрации результатов после группировки (в отличие от `WHERE`, который фильтрует до группировки).

```sql
-- Города, где более 10 студентов
SELECT city, COUNT(*) AS student_count
FROM students
GROUP BY city
HAVING COUNT(*) > 10;

-- Средний возраст > 20
SELECT city, AVG(age) AS avg_age
FROM students
GROUP BY city
HAVING AVG(age) > 20;
```

### Разница между WHERE и HAVING

| WHERE | HAVING |
|-------|--------|
| Фильтрует строки ДО группировки | Фильтрует группы ПОСЛЕ группировки |
| Не может использовать агрегатные функции | Может использовать агрегатные функции |
| Работает с отдельными строками | Работает с группами строк |

**Порядок выполнения:**
1. `WHERE` — фильтрация строк
2. `GROUP BY` — группировка
3. `HAVING` — фильтрация групп

---

## 9. DISTINCT — уникальные значения

```sql
-- Список уникальных городов
SELECT DISTINCT city FROM students;

-- Уникальные комбинации
SELECT DISTINCT city, faculty FROM students;
```

---

## 10. Порядок выполнения SQL-запроса

```sql
SELECT     -- 5. Выбор столбцов
    city,
    COUNT(*) AS student_count,
    AVG(age) AS avg_age
FROM students           -- 1. Выбор таблицы
WHERE age >= 18         -- 2. Фильтрация строк
GROUP BY city           -- 3. Группировка
HAVING COUNT(*) >= 5    -- 4. Фильтрация групп
ORDER BY student_count DESC  -- 6. Сортировка
LIMIT 10;               -- 7. Ограничение результатов
```

**Логический порядок выполнения:**
1. `FROM` — выбор таблицы
2. `WHERE` — фильтрация строк
3. `GROUP BY` — группировка
4. `HAVING` — фильтрация групп
5. `SELECT` — выбор столбцов
6. `ORDER BY` — сортировка
7. `LIMIT` — ограничение результатов

---

## 11. Примеры для лингвистических задач

### 11.1. Работа с корпусом текстов

```sql
-- Частотность слов (частотный словарь)
SELECT word, COUNT(*) AS frequency
FROM corpus
GROUP BY word
ORDER BY frequency DESC
LIMIT 100;

-- Слова определенной длины
SELECT word FROM dictionary
WHERE LENGTH(word) BETWEEN 5 AND 10;

-- Поиск слов с определенным корнем
SELECT word FROM dictionary
WHERE word LIKE '%говор%';
```

### 11.2. Анализ морфологии

```sql
-- Количество слов по частям речи
SELECT pos_tag, COUNT(*) AS word_count
FROM words
GROUP BY pos_tag
ORDER BY word_count DESC;

-- Глаголы совершенного вида
SELECT lemma, word_form
FROM morphology
WHERE pos = 'VERB' AND aspect = 'perfect';

-- Существительные по падежам
SELECT case_form, COUNT(*) AS count
FROM nouns
WHERE pos = 'NOUN'
GROUP BY case_form;
```

### 11.3. Работа с n-граммами

```sql
-- Самые частотные биграммы
SELECT word1, word2, COUNT(*) AS freq
FROM bigrams
GROUP BY word1, word2
HAVING COUNT(*) > 5
ORDER BY freq DESC;

-- Триграммы с определенным словом
SELECT word1, word2, word3, frequency
FROM trigrams
WHERE word2 = 'быть'
ORDER BY frequency DESC
LIMIT 20;
```

### 11.4. Работа с аннотированными текстами

```sql
-- Средняя длина предложений в текстах разных жанров
SELECT genre, AVG(sentence_length) AS avg_length
FROM sentences
GROUP BY genre
ORDER BY avg_length DESC;

-- Тексты с высокой лексической разнообразностью
SELECT text_id, COUNT(DISTINCT lemma) AS unique_words
FROM tokens
GROUP BY text_id
HAVING COUNT(DISTINCT lemma) > 1000;
```

### 11.5. Словарные запросы

```sql
-- Синонимы конкретного слова
SELECT synonym
FROM synonyms
WHERE word = 'большой'
ORDER BY synonym;

-- Слова с определенной валентностью
SELECT verb, valency_pattern, example
FROM valency_dict
WHERE verb LIKE 'говор%';
```

---

## 12. Работа с текстовыми функциями в SELECT

### 12.1. Строковые функции

```sql
-- LENGTH / CHAR_LENGTH — длина строки
SELECT word, LENGTH(word) AS word_length
FROM dictionary
WHERE LENGTH(word) > 10;

-- UPPER / LOWER — изменение регистра
SELECT UPPER(word) AS uppercase, LOWER(word) AS lowercase
FROM words;

-- SUBSTRING — извлечение подстроки
SELECT word, SUBSTRING(word, 1, 3) AS prefix
FROM dictionary;

-- CONCAT — конкатенация строк
SELECT CONCAT(first_name, ' ', last_name) AS full_name
FROM authors;

-- REPLACE — замена подстроки
SELECT word, REPLACE(word, 'а', 'я') AS replaced
FROM dictionary;
```

### 12.2. Регулярные выражения (зависит от СУБД)

```sql
-- PostgreSQL
SELECT word FROM dictionary
WHERE word ~ '^[аеёиоуыэюя]'; -- слова на гласную

-- MySQL
SELECT word FROM dictionary
WHERE word REGEXP '^[аеёиоуыэюя]';
```

---

## 13. CASE — условные выражения

```sql
-- Простой CASE
SELECT 
    word,
    CASE 
        WHEN LENGTH(word) <= 3 THEN 'короткое'
        WHEN LENGTH(word) <= 6 THEN 'среднее'
        ELSE 'длинное'
    END AS word_category
FROM dictionary;

-- Категоризация частей речи
SELECT 
    pos,
    CASE pos
        WHEN 'NOUN' THEN 'существительное'
        WHEN 'VERB' THEN 'глагол'
        WHEN 'ADJ' THEN 'прилагательное'
        ELSE 'другое'
    END AS pos_russian
FROM words;
```

---

## 14. Подзапросы в SELECT

```sql
-- Скалярный подзапрос
SELECT 
    word,
    frequency,
    (SELECT AVG(frequency) FROM corpus) AS avg_frequency
FROM corpus
WHERE frequency > (SELECT AVG(frequency) FROM corpus);

-- Подзапрос с IN
SELECT word FROM dictionary
WHERE word_id IN (
    SELECT word_id FROM corpus
    WHERE frequency > 1000
);
```

---

## 15. Комплексный пример для лингвистики

```sql
-- Анализ корпуса: частотность слов по частям речи
SELECT 
    pos_tag,
    COUNT(*) AS total_words,
    COUNT(DISTINCT lemma) AS unique_lemmas,
    AVG(LENGTH(word_form)) AS avg_word_length,
    MIN(frequency) AS min_freq,
    MAX(frequency) AS max_freq,
    CASE 
        WHEN COUNT(*) > 10000 THEN 'высокочастотная'
        WHEN COUNT(*) > 1000 THEN 'среднечастотная'
        ELSE 'низкочастотная'
    END AS frequency_category
FROM annotated_corpus
WHERE word_form NOT LIKE '%[0-9]%'  -- исключаем числа
GROUP BY pos_tag
HAVING COUNT(*) > 100  -- только значимые категории
ORDER BY total_words DESC;
```

---

## 16. Важные замечания и best practices

### 16.1. Работа с NULL

- `NULL` не равен ничему, даже другому `NULL`
- Используйте `IS NULL` и `IS NOT NULL`, а не `= NULL`
- Агрегатные функции (кроме `COUNT(*)`) игнорируют `NULL`

```sql
-- НЕПРАВИЛЬНО
SELECT * FROM students WHERE email = NULL;

-- ПРАВИЛЬНО
SELECT * FROM students WHERE email IS NULL;
```

### 16.2. Производительность

- Используйте индексы для столбцов в `WHERE`, `JOIN`, `ORDER BY`
- Избегайте `SELECT *` — выбирайте только нужные столбцы
- `LIMIT` помогает ограничить объем данных
- Используйте `EXPLAIN` для анализа запросов

```sql
-- Анализ плана выполнения запроса
EXPLAIN SELECT * FROM corpus WHERE word LIKE 'говор%';
```

### 16.3. Читаемость запросов

- Используйте форматирование и отступы
- Давайте понятные имена псевдонимам
- Комментируйте сложные запросы
- Разбивайте сложные запросы на подзапросы

---

## 17. Практические задания

### Уровень 1 (базовый)
1. Выберите все записи из таблицы словаря, где слово начинается на букву 'а'
2. Найдите все глаголы в прошедшем времени
3. Отсортируйте слова по длине (от длинных к коротким)
4. Выберите первые 20 самых частотных слов

### Уровень 2 (средний)
5. Найдите среднюю длину слов для каждой части речи
6. Подсчитайте количество уникальных лемм в корпусе
7. Найдите все существительные женского рода в родительном падеже
8. Выберите части речи, где средняя длина слова больше 7 символов

### Уровень 3 (продвинутый)
9. Создайте частотный словарь с категоризацией по частотности
10. Найдите слова, встречающиеся чаще среднего по корпусу
11. Для каждого жанра текста найдите топ-10 самых частотных слов
12. Проанализируйте распределение длин слов по частям речи

---

## 18. Различия в синтаксисе между СУБД

### PostgreSQL
```sql
-- Ограничение результатов
SELECT * FROM words LIMIT 10 OFFSET 5;

-- Регулярные выражения
SELECT * FROM words WHERE word ~ '^[а-я]+$';
```

### MySQL
```sql
-- Ограничение результатов
SELECT * FROM words LIMIT 5, 10;

-- Регулярные выражения
SELECT * FROM words WHERE word REGEXP '^[а-я]+$';
```

### SQLite
```sql
-- Ограничение результатов
SELECT * FROM words LIMIT 10 OFFSET 5;

-- Нет встроенной поддержки регулярных выражений
```

---

## 19. Полезные ресурсы

### Интерактивные платформы
- [SQLZoo](https://sqlzoo.net/) — интерактивные упражнения
- [LeetCode Database](https://leetcode.com/problemset/database/) — задачи по SQL
- [HackerRank SQL](https://www.hackerrank.com/domains/sql) — практика SQL

### Документация
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [MySQL Documentation](https://dev.mysql.com/doc/)
- [SQLite Documentation](https://www.sqlite.org/docs.html)

### Учебные материалы
- [Mode SQL Tutorial](https://mode.com/sql-tutorial/) — учебник с примерами
- [W3Schools SQL](https://www.w3schools.com/sql/) — справочник с примерами

### Для лингвистов
- Корпус НКРЯ (Национальный корпус русского языка)
- Leipzig Corpora Collection
- Universal Dependencies (UD) — морфологически аннотированные корпуса

---

## 20. Шпаргалка по SELECT

```sql
-- Полный синтаксис SELECT
SELECT [DISTINCT] столбцы | *
FROM таблица
[WHERE условие]
[GROUP BY столбцы]
[HAVING условие_для_групп]
[ORDER BY столбцы [ASC|DESC]]
[LIMIT количество [OFFSET смещение]];

-- Агрегатные функции
COUNT(*), COUNT(столбец), SUM(), AVG(), MIN(), MAX()

-- Операторы WHERE
=, !=, <, >, <=, >=, BETWEEN, IN, LIKE, IS NULL

-- Логические операторы
AND, OR, NOT

-- Символы LIKE
% — любое количество символов
_ — один символ

-- Порядок выполнения
FROM → WHERE → GROUP BY → HAVING → SELECT → ORDER BY → LIMIT
```

---

**Конец конспекта**

*Создано для специальности «Вычислительная лингвистика»*