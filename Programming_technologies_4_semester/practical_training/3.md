# Интеграция Python и SQLite

**Предмет:** Технологии программирования  
**Специальность:** Компьютерная лингвистика  
**Уровень сложности:** Легко  



## Содержание

1. [Введение](#введение)
2. [Основные концепции](#основные-концепции)
3. [Установка и подготовка](#установка-и-подготовка)
4. [Подключение к базе данных](#подключение-к-базе-данных)
5. [Основные операции CRUD](#основные-операции-crud)
6. [Практические упражнения](#практические-упражнения)
7. [Контрольные вопросы](#контрольные-вопросы)



## Введение

SQLite — это легкая встроенная реляционная база данных, которая хранится в одном файле. Python включает встроенный модуль `sqlite3`, позволяющий работать с SQLite без установки дополнительных пакетов.

### Преимущества SQLite:
- Не требует отдельного сервера
- Хороша для небольших проектов и прототипирования
- Легко портируется между системами
- Идеальна для локальных приложений



## Основные концепции

### База данных (Database)
Контейнер для хранения всех таблиц и данных.

### Таблица (Table)
Структурированное хранилище данных в виде строк и столбцов.

### Запрос (Query)
Инструкция для получения или изменения данных в базе.

### Курсор (Cursor)
Объект для выполнения SQL-команд и получения результатов.

### Транзакция (Transaction)
Группа операций, которые либо все выполняются, либо все отменяются.



## Установка и подготовка

### Проверка наличия модуля

```python
import sqlite3
print(sqlite3.version)  # Версия модуля
print(sqlite3.sqlite_version)  # Версия SQLite
```

Модуль `sqlite3` встроен в Python 3, поэтому никакой дополнительной установки не требуется.



## Подключение к базе данных

### Создание или открытие базы данных

```python
import sqlite3

# Подключение к файлу базы данных (создастся, если не существует)
connection = sqlite3.connect('example.db')

# Создание курсора для выполнения команд
cursor = connection.cursor()

# Закрытие соединения
connection.close()
```

### Работа с контекстным менеджером (рекомендуется)

```python
import sqlite3

with sqlite3.connect('example.db') as connection:
    cursor = connection.cursor()
    # Ваши операции здесь
    # Соединение закроется автоматически
```



## Основные операции CRUD

### CREATE (Создание таблицы)

```python
import sqlite3

with sqlite3.connect('library.db') as connection:
    cursor = connection.cursor()
    
    # Создание таблицы для библиотеки
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS books (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            title TEXT NOT NULL,
            author TEXT NOT NULL,
            year INTEGER,
            pages INTEGER
        )
    ''')
    
    connection.commit()  # Сохранение изменений
    print("Таблица создана успешно")
```

### INSERT (Вставка данных)

```python
# Вставка одной записи
cursor.execute('''
    INSERT INTO books (title, author, year, pages)
    VALUES (?, ?, ?, ?)
''', ('Война и мир', 'Лев Толстой', 1869, 1200))

# Вставка нескольких записей
books = [
    ('Преступление и наказание', 'Федор Достоевский', 1866, 671),
    ('Мастер и Маргарита', 'Михаил Булгаков', 1966, 384),
    ('Евгений Онегин', 'Александр Пушкин', 1833, 200)
]

cursor.executemany('''
    INSERT INTO books (title, author, year, pages)
    VALUES (?, ?, ?, ?)
''', books)

connection.commit()
print(f"Добавлено {cursor.rowcount} записей")
```

### READ (Чтение данных)

```python
# Получение всех записей
cursor.execute('SELECT * FROM books')
all_books = cursor.fetchall()

for book in all_books:
    print(book)

# Получение одной записи
cursor.execute('SELECT * FROM books WHERE id = ?', (1,))
one_book = cursor.fetchone()
print(one_book)

# Получение определенного количества записей
cursor.execute('SELECT title, author FROM books LIMIT 2')
some_books = cursor.fetchmany(2)

# Использование описания столбцов
cursor.execute('SELECT * FROM books')
columns = [description[0] for description in cursor.description]
print(columns)  # ['id', 'title', 'author', 'year', 'pages']
```

### UPDATE (Обновление данных)

```python
# Обновление одной записи
cursor.execute('''
    UPDATE books
    SET pages = ?
    WHERE title = ?
''', (350, 'Евгений Онегин'))

# Обновление нескольких записей
cursor.execute('''
    UPDATE books
    SET year = year + 1
    WHERE author = ?
''', ('Лев Толстой',))

connection.commit()
print(f"Обновлено {cursor.rowcount} записей")
```

### DELETE (Удаление данных)

```python
# Удаление записи
cursor.execute('DELETE FROM books WHERE id = ?', (4,))

# Удаление по условию
cursor.execute('DELETE FROM books WHERE year < ?', (1850,))

connection.commit()
print(f"Удалено {cursor.rowcount} записей")
```

### Более сложные запросы

```python
# Сортировка
cursor.execute('SELECT * FROM books ORDER BY year DESC')

# Фильтрация
cursor.execute('SELECT * FROM books WHERE pages > ? AND year > ?', (500, 1850))

# Агрегирующие функции
cursor.execute('SELECT COUNT(*) as total FROM books')
count = cursor.fetchone()[0]

cursor.execute('SELECT AVG(pages) as avg_pages FROM books')
avg = cursor.fetchone()[0]

# GROUP BY
cursor.execute('''
    SELECT author, COUNT(*) as book_count
    FROM books
    GROUP BY author
    ORDER BY book_count DESC
''')
```



## Практические упражнения

### Упражнение 1: Создание базы данных студентов

Создайте базу данных для хранения информации о студентах:

```python
import sqlite3

# Создайте таблицу 'students' со следующими полями:
# - id (целое число, первичный ключ)
# - name (текст, обязательное)
# - group (текст)
# - average_grade (вещественное число)

# Добавьте 5 студентов в таблицу
# Выведите всех студентов, отсортированных по среднему баллу

# Ожидаемый результат:
# (1, 'Иван Петров', 'ЛГ-101', 4.5)
# (2, 'Мария Сидорова', 'ЛГ-101', 4.8)
# ...
```

**Решение:**

```python
import sqlite3

with sqlite3.connect('university.db') as connection:
    cursor = connection.cursor()
    
    # Создание таблицы
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS students (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT NOT NULL,
            group TEXT,
            average_grade REAL
        )
    ''')
    
    # Добавление студентов
    students = [
        ('Иван Петров', 'ЛГ-101', 4.5),
        ('Мария Сидорова', 'ЛГ-101', 4.8),
        ('Алексей Новиков', 'ЛГ-102', 3.9),
        ('Екатерина Волкова', 'ЛГ-101', 4.7),
        ('Дмитрий Соколов', 'ЛГ-102', 4.2)
    ]
    
    cursor.executemany('''
        INSERT INTO students (name, group, average_grade)
        VALUES (?, ?, ?)
    ''', students)
    
    # Вывод студентов, отсортированных по баллу
    cursor.execute('''
        SELECT * FROM students
        ORDER BY average_grade DESC
    ''')
    
    print("Студенты (отсортированы по среднему баллу):")
    for student in cursor.fetchall():
        print(student)
    
    connection.commit()
```



### Упражнение 2: Работа с таблицей слов

Создайте простой словарь с таблицей слов:

```python
import sqlite3

# Создайте таблицу 'vocabulary' с полями:
# - id (первичный ключ)
# - russian_word (русское слово)
# - english_word (английское слово)
# - part_of_speech (часть речи)

# Добавьте 10 слов
# Найдите все существительные (nouns)
# Обновите одно слово
# Удалите слово с id = 3

# Выведите оставшиеся слова
```

**Решение:**

```python
import sqlite3

with sqlite3.connect('vocabulary.db') as connection:
    cursor = connection.cursor()
    
    # Создание таблицы
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS vocabulary (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            russian_word TEXT NOT NULL,
            english_word TEXT NOT NULL,
            part_of_speech TEXT
        )
    ''')
    
    # Добавление слов
    words = [
        ('кошка', 'cat', 'noun'),
        ('быстро', 'quickly', 'adverb'),
        ('красивый', 'beautiful', 'adjective'),
        ('бегать', 'run', 'verb'),
        ('книга', 'book', 'noun'),
        ('тихо', 'quietly', 'adverb'),
        ('большой', 'big', 'adjective'),
        ('читать', 'read', 'verb'),
        ('стол', 'table', 'noun'),
        ('яркий', 'bright', 'adjective')
    ]
    
    cursor.executemany('''
        INSERT INTO vocabulary (russian_word, english_word, part_of_speech)
        VALUES (?, ?, ?)
    ''', words)
    
    # Поиск существительных
    cursor.execute('''
        SELECT * FROM vocabulary
        WHERE part_of_speech = 'noun'
    ''')
    print("Существительные:")
    for word in cursor.fetchall():
        print(word)
    
    # Обновление слова
    cursor.execute('''
        UPDATE vocabulary
        SET english_word = 'dog'
        WHERE russian_word = 'собака' AND id = 1
    ''')
    
    # Удаление слова
    cursor.execute('DELETE FROM vocabulary WHERE id = 3')
    
    # Вывод всех оставшихся слов
    cursor.execute('SELECT * FROM vocabulary')
    print("\nВсе слова в словаре:")
    for word in cursor.fetchall():
        print(word)
    
    connection.commit()
```



### Упражнение 3: Статистика по базе данных

Работайте со статистикой и агрегирующими функциями:

```python
import sqlite3

# На основе таблицы 'books' из примера выше:
# 1. Найдите количество книг в базе
# 2. Найдите среднее количество страниц
# 3. Найдите автора с наибольшим количеством книг
# 4. Найдите самую старую книгу
# 5. Вывести все книги, отсортированные по автору
```

**Решение:**

```python
import sqlite3

with sqlite3.connect('library.db') as connection:
    cursor = connection.cursor()
    
    # Количество книг
    cursor.execute('SELECT COUNT(*) FROM books')
    total = cursor.fetchone()[0]
    print(f"Всего книг: {total}")
    
    # Среднее количество страниц
    cursor.execute('SELECT AVG(pages) FROM books')
    avg_pages = cursor.fetchone()[0]
    print(f"Среднее количество страниц: {avg_pages:.2f}")
    
    # Автор с наибольшим количеством книг
    cursor.execute('''
        SELECT author, COUNT(*) as count
        FROM books
        GROUP BY author
        ORDER BY count DESC
        LIMIT 1
    ''')
    result = cursor.fetchone()
    if result:
        print(f"Автор с наибольшим количеством книг: {result[0]} ({result[1]} книг)")
    
    # Самая старая книга
    cursor.execute('''
        SELECT title, author, year
        FROM books
        ORDER BY year ASC
        LIMIT 1
    ''')
    result = cursor.fetchone()
    if result:
        print(f"Самая старая книга: '{result[0]}' ({result[1]}, {result[2]})")
    
    # Все книги по авторам
    cursor.execute('''
        SELECT * FROM books
        ORDER BY author
    ''')
    print("\nКниги, отсортированные по авторам:")
    for book in cursor.fetchall():
        print(book)
```



### Упражнение 4: Обработка ошибок

Напишите программу с обработкой ошибок:

```python
import sqlite3

try:
    with sqlite3.connect('test.db') as connection:
        cursor = connection.cursor()
        
        # Попытка создать таблицу с ошибкой синтаксиса
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS users (
                id INTEGER PRIMARY KEY,
                email TEXT UNIQUE NOT NULL,
                password TEXT NOT NULL
            )
        ''')
        
        # Вставка уникального значения
        cursor.execute('''
            INSERT INTO users (email, password)
            VALUES (?, ?)
        ''', ('user@example.com', 'password123'))
        
        # Попытка вставить дубликат
        cursor.execute('''
            INSERT INTO users (email, password)
            VALUES (?, ?)
        ''', ('user@example.com', 'password456'))
        
        connection.commit()
        
except sqlite3.IntegrityError as e:
    print(f"Ошибка целостности данных: {e}")
except sqlite3.OperationalError as e:
    print(f"Ошибка операции: {e}")
except Exception as e:
    print(f"Неожиданная ошибка: {e}")
finally:
    print("Программа завершена")
```



### Упражнение 5: Функции для работы с БД

Создайте класс для управления базой данных:

```python
import sqlite3
from typing import List, Tuple

class DatabaseManager:
    def __init__(self, db_name: str):
        self.db_name = db_name
    
    def execute_query(self, query: str, params: Tuple = None):
        """Выполнить запрос без получения результатов"""
        with sqlite3.connect(self.db_name) as connection:
            cursor = connection.cursor()
            if params:
                cursor.execute(query, params)
            else:
                cursor.execute(query)
            connection.commit()
            return cursor.rowcount
    
    def fetch_all(self, query: str, params: Tuple = None) -> List:
        """Получить все результаты запроса"""
        with sqlite3.connect(self.db_name) as connection:
            cursor = connection.cursor()
            if params:
                cursor.execute(query, params)
            else:
                cursor.execute(query)
            return cursor.fetchall()
    
    def fetch_one(self, query: str, params: Tuple = None):
        """Получить один результат запроса"""
        with sqlite3.connect(self.db_name) as connection:
            cursor = connection.cursor()
            if params:
                cursor.execute(query, params)
            else:
                cursor.execute(query)
            return cursor.fetchone()

# Использование класса
db = DatabaseManager('example.db')

# Создание таблицы
db.execute_query('''
    CREATE TABLE IF NOT EXISTS products (
        id INTEGER PRIMARY KEY,
        name TEXT NOT NULL,
        price REAL
    )
''')

# Добавление данных
db.execute_query('''
    INSERT INTO products (name, price)
    VALUES (?, ?)
''', ('Ноутбук', 50000))

# Получение данных
products = db.fetch_all('SELECT * FROM products')
print(products)
```



## Контрольные вопросы

### Теоретические вопросы

1. **Что такое SQLite и какие его основные характеристики?**

2. **Какой модуль Python используется для работы с SQLite?**

3. **Какая разница между методами `commit()` и `close()`?**

4. **Что такое курсор и зачем он нужен?**

5. **Почему рекомендуется использовать параметризованные запросы (с `?`) вместо прямого подстановки переменных?**

6. **В чем преимущество использования контекстного менеджера (`with`) при работе с базой данных?**

7. **Какие методы используются для получения результатов из базы данных?**
   - a) `fetch()`
   - b) `fetchone()`, `fetchall()`, `fetchmany()`
   - c) `get()`
   - d) `retrieve()`

8. **Какая команда используется для создания таблицы?**
   - a) `CREATE TABLE`
   - b) `NEW TABLE`
   - c) `MAKE TABLE`
   - d) `INSERT TABLE`

9. **Что возвращает метод `cursor.rowcount` после выполнения операции?**

10. **Какие основные типы данных поддерживает SQLite?** (Назовите минимум 3)

### Практические вопросы

11. **Напишите код для создания таблицы 'authors' с полями id, name и birth_year.**

12. **Напишите запрос для получения всех книг автора 'Лев Толстой' из таблицы 'books'.**

13. **Какой код нужно написать, чтобы удалить все книги, опубликованные раньше 1900 года?**

14. **Напишите запрос для получения количества книг по каждому автору, отсортированное по убыванию количества.**

15. **Как обработать исключение `sqlite3.IntegrityError` при вставке данных?**

### Вопросы для размышления

16. **Когда следует использовать SQLite вместо других СУБД?**

17. **Какие потенциальные проблемы могут возникнуть при работе с большими базами данных в SQLite?**

18. **Как можно обеспечить безопасность при работе с базами данных (защита от SQL-инъекций)?**

19. **Какова роль первичного ключа (PRIMARY KEY) в таблице?**

20. **Почему важно использовать транзакции и метод `commit()` при работе с БД?**



## Дополнительные ресурсы

- [Официальная документация sqlite3 для Python](https://docs.python.org/3/library/sqlite3.html)
- [SQL синтаксис на сайте SQLite](https://www.sqlite.org/lang.html)
- [Типы данных в SQLite](https://www.sqlite.org/datatype3.html)

